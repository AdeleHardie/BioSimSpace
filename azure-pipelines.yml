# Pipeline to build the latest version of BioSimSpace by starting from a docker
# image of a recent build. This avoids the (VERY) long build times if
# we start from scratch. You should ensure that 'biosimspace-devel:latest'
# corresponds to the right place to start...

trigger:
- devel

pool:
  vmImage: 'Ubuntu-16.04'

steps:
- script: |
    # login to docker and get the last successful biosimspace-devel build
    docker login -u $id -p $pswd
    docker pull biosimspace/biosimspace-devel:latest

    # ensure the last known safe state is saved on docker
    docker tag biosimspace/biosimspace-devel:latest biosimspace/biosimspace-devel:last
    docker push biosimspace/biosimspace-devel:last
  env:
    pswd: $(dockerPassword)
    id: $(dockerId)
  displayName: 'Pull biosimspace-devel:latest'
